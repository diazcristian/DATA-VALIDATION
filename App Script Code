var mainWsName = "Analysis";
var optionsWsName = "Framework";
var firstColumn = 1; 
var secondColumn = 2; 
var thirdColumn = 3; 
var ws = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(mainWsName);
var wsOptions = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(optionsWsName);
var options = wsOptions.getRange(2,1,wsOptions.getLastRow()-1,3).getValues();

function onEdit(e) {
  
  var activeCell = e.range;
  var val = activeCell.getValue();
  var r = activeCell.getRow();
  var c = activeCell.getColumn();
  var wsName = activeCell.getSheet().getName();
  if(wsName===mainWsName && c === firstColumn && r > 1){
  applyFirstLevelValidation(val,r);
 
} else if(wsName===mainWsName && c === secondColumn && r > 1){
applySecondValidation(val,r);
 }
}

function applyFirstValidation(val,r){

if(val === ""){
  ws.getRange(r, secondColumn).clearContent();
  ws.getRange(r, secondColumn).clearDataValidations();
  ws.getRange(r, thirdColumn).clearContent();
  ws.getRange(r, thirdColumn).clearDataValidations();
  } else{
   ws.getRange(r, secondColumn).clearContent();
   ws.getRange(r, secondColumn).clearDataValidations();
   ws.getRange(r, thirdColumn).clearContent();
   ws.getRange(r, thirdColumn).clearDataValidations();
  var filteredOptions = options.filter(function(o){return o[0] === val });
  var listToApply = filteredOptions.map(function(o){return o[1]});
  var cell = ws.getRange(r, secondColumn);
  applyValidationToCell(listToApply, cell);
 }
}

function applySecondValidation(val,r){

if(val === ""){
  ws.getRange(r, thirdColumn).clearContent();
  ws.getRange(r, thirdColumn).clearDataValidations();
  } else{
   ws.getRange(r, thirdColumn).clearContent();
   var firstColValue = ws.getRange(r, firstColumn).getValue();
   var filteredOptions = options.filter(function(o){return o[0] === firstColValue && o[1] === val });
   var listToApply = filteredOptions.map(function(o){return o[2]});
   var cell = ws.getRange(r, thirdColumn);
  applyValidationToCell(listToApply, cell);
 }
}

  function applyValidationToCell(list, cell){
    
    var rule = SpreadsheetApp.newDataValidation().requireValueInList(list).setAllowInvalid(false).build();
    
    cell.setDataValidation(rule);
}
